
<!DOCTYPE html>
<html>
<head>
    <title>Debug Auth State</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .info { background: #f0f8ff; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe4e1; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #f0fff0; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîç Auth State Debug</h1>
    
    <div id="authInfo"></div>
    
    <h2>Actions</h2>
    <button onclick="clearAuth()">Clear Auth Data</button>
    <button onclick="setTestUser()">Set Test User (ID: 2)</button>
    <button onclick="checkHistory()">Test History Loading</button>
    
    <div id="results"></div>

    <script>
        function displayAuthInfo() {
            const authToken = localStorage.getItem('auth_token');
            const authUser = localStorage.getItem('auth_user');
            
            let html = '<h2>Current Auth State:</h2>';
            
            if (authUser && authUser !== 'undefined') {
                try {
                    const user = JSON.parse(authUser);
                    html += '<div class="success">';
                    html += '<strong>‚úÖ User Authenticated:</strong><br>';
                    html += 'ID: ' + user.id + '<br>';
                    html += 'Username: ' + user.username + '<br>';
                    html += 'Full Name: ' + user.fullName + '<br>';
                    html += 'Email: ' + user.email + '<br>';
                    html += '</div>';
                } catch (e) {
                    html += '<div class="error">‚ùå Invalid user data in localStorage</div>';
                }
            } else {
                html += '<div class="error">‚ùå No user authenticated</div>';
            }
            
            if (authToken) {
                html += '<div class="info">üîë Token: ' + authToken.substring(0, 20) + '...</div>';
            } else {
                html += '<div class="info">üîë No token stored</div>';
            }
            
            document.getElementById('authInfo').innerHTML = html;
        }
        
        function clearAuth() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('auth_user');
            displayAuthInfo();
            document.getElementById('results').innerHTML = '<div class="info">üßπ Auth data cleared</div>';
        }
        
        function setTestUser() {
            const testUser = {
                id: "2",
                fullName: "Test User",
                username: "testuser",
                email: "test@example.com",
                phoneNumber: ""
            };
            
            localStorage.setItem('auth_user', JSON.stringify(testUser));
            displayAuthInfo();
            document.getElementById('results').innerHTML = '<div class="success">‚úÖ Test user set (ID: 2)</div>';
        }
        
        async function checkHistory() {
            const authUser = localStorage.getItem('auth_user');
            if (!authUser || authUser === 'undefined') {
                document.getElementById('results').innerHTML = '<div class="error">‚ùå No user authenticated - cannot test history</div>';
                return;
            }
            
            try {
                const user = JSON.parse(authUser);
                const userId = parseInt(user.id);
                
                document.getElementById('results').innerHTML = '<div class="info">üîÑ Testing history for user ID: ' + userId + '</div>';
                
                // Test the API endpoint that the Angular app would call
                const response = await fetch('http://localhost:5150/api/experiments/results/test-experiment-123/' + userId);
                
                if (response.ok) {
                    const results = await response.json();
                    document.getElementById('results').innerHTML = 
                        '<div class="success">‚úÖ Found ' + results.length + ' results for user ' + userId + '</div>';
                } else {
                    document.getElementById('results').innerHTML = 
                        '<div class="error">‚ùå API call failed: ' + response.status + '</div>';
                }
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="error">‚ùå Error: ' + error.message + '</div>';
            }
        }
        
        // Initialize
        displayAuthInfo();
    </script>
</body>
</html>
